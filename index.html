<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .input-section, .tournament-section {
            margin-bottom: 20px;
        }

        .group, .matches-group {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .group h3, .matches-group h3 {
            margin: 0;
        }
    </style>
</head>
<body>
    <h1>Tournament Generator</h1>

    <div class="input-section">
        <label for="total-couples">Enter Total Number of Couples:</label>
        <input type="number" id="total-couples" placeholder="12">
        <button id="btn-set-couples" onclick="setTotalCouples()">Set Total Couples</button>
        <br><br>
        <label for="couple-name">Add Couple's Full Name:</label>
        <input type="text" id="couple-name" placeholder="John Doe and Jane Doe">
        <button onclick="addCouple()">Add Couple</button>
    </div>

    <div class="tournament-section">
        <h2>Groups</h2>
        <div id="groups-container">
            <!-- Groups will appear here -->
        </div>
        <h2>Groups Matches</h2>
        <div id="groups-matches-container">
            <!-- Groups will appear here -->
        </div>
    </div>

    <script>
        const couples = [];
        let groups = {};
        let totalCouples = 0;
        let amountOfGroups = 0;
        let lastIteration = false;
        let results = [];

        function setTotalCouples() {
            const totalCouplesInput = document.getElementById('total-couples');
            totalCouples = parseInt(totalCouplesInput.value);

            if (totalCouples > 0) {
                calculateGroups();
                totalCouplesInput.setAttribute("disabled", "disabled");
                document.getElementById('btn-set-couples').setAttribute("disabled", "disabled");
                renderGroups();
            } else {
                alert('Please enter a valid total number of couples.');
            }
        }

        function calculateGroups() {
            // Calculate number of groups needed based on total couples
            amountOfGroups = Math.ceil(totalCouples / 4); // 4 pairs (8 people) per group
            groups = {};

            for (let i = 0; i < amountOfGroups; i++) {
                const groupName = `Group ${String.fromCharCode(65 + i)}`;
                groups[groupName] = [];
            }
        }

        function addCouple() {
            const coupleInput = document.getElementById('couple-name');
            const coupleName = coupleInput.value.trim();

            if (coupleName.length > 0) {
                if (couples.length < totalCouples) {
                    couples.push(coupleName);
                    distributeCouple();
                    coupleInput.value = '';
                    coupleInput.focus();
                    renderGroups();
                    renderMatches();
                } else {
                    alert('All couples have already been added.');
                }
            } else {
                alert('Please enter a valid couple name.');
            }
        }

        function distributeCouple() {
            // Reset groups
            for (const groupName in groups) {
                groups[groupName] = [];
            }

            // Distribute couples sequentially, ensuring at least 4 couples per group
            let currentGroupIndex = 0;

            for (let i = 0; i < couples.length; i += 2) {
                const couple1 = couples[i];
                const couple2 = couples[i + 1] || null; // Handle odd number of couples
                const groupName = `Group ${String.fromCharCode(65 + currentGroupIndex)}`;

                if (couple1) groups[groupName].push(couple1);
                if (couple2) groups[groupName].push(couple2);

                // Switch to next group
                if (currentGroupIndex === Object.keys(groups).length - 1) {
                    if (Object.values(groups).every(group => group.length >= 4)) {
                        lastIteration = true;
                    } else {
                        currentGroupIndex = 0;
                    }
                } else {
                    if (groups[groupName].length % 2 === 0 && !lastIteration) {
                        currentGroupIndex++;
                    }
                }


            }
        }

        function renderGroups() {
            const groupsContainer = document.getElementById('groups-container');
            groupsContainer.innerHTML = '';

            for (const groupName in groups) {
                const groupDiv = document.createElement('div');
                groupDiv.classList.add('group');

                const groupTitle = document.createElement('h3');
                groupTitle.textContent = groupName;
                groupDiv.appendChild(groupTitle);

                const groupList = document.createElement('ul');
                groups[groupName].forEach(couple => {
                    const listItem = document.createElement('li');
                    listItem.textContent = couple;
                    groupList.appendChild(listItem);
                });
                groupDiv.appendChild(groupList);

                groupsContainer.appendChild(groupDiv);
            }
        }

        function renderMatches() {
            const matchesContainer = document.getElementById('groups-matches-container');
            matchesContainer.innerHTML = '';
            let matchCounter = 1;

            for (const groupName in groups) {
                const group = groups[groupName];
                if (group.length < 2) continue;

                const groupMatchesDiv = document.createElement('div');
                groupMatchesDiv.classList.add('matches-group');

                const groupTitle = document.createElement('h3');
                groupTitle.textContent = `Matches for ${groupName}`;
                groupMatchesDiv.appendChild(groupTitle);

                const matchesList = document.createElement('ul');
                for (let i = 0; i < group.length; i += 2) {
                    if (group[i + 1]) {
                        const matchItem = document.createElement('li');
                        matchItem.textContent = `${group[i]} VS ${group[i + 1]} - `;
                        // Create the input field
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.placeholder = 'Enter Result';
                        input.id = `match-${matchCounter}`; // Unique ID for the input
                        input.addEventListener('change', function() {
                            let numbers = this.value.split(" - ");
                            let score1 = parseInt(numbers[0]);
                            let score2 = parseInt(numbers[1]);
                            if (score1 >= 0 && score2 >= 0) {
                                let winner = score1 > score2 ? group[i] : group[i + 1];
                                console.log(`The winner of the match is: ${winner}`);
                                results.push({
                                    winner: winner,
                                    groupName: groupName
                                });
                                
                                // Check if all matches have been played
                                if (results.length === (group.length / 2)) {
                                    console.log('All matches have been played!');
                                    console.log('Results:', results);
                                }
                            }
                        });
                        matchCounter++; // Increment global counter for next ID
                        
                        matchItem.appendChild(input);
                        matchesList.appendChild(matchItem);
                    }
                }
                groupMatchesDiv.appendChild(matchesList);
                matchesContainer.appendChild(groupMatchesDiv);
            }
        }
    </script>
</body>
</html>
